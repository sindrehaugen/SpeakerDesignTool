<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speaker Design Tool v1.15</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <link rel="stylesheet" href="style.css">

    <script src="database.js"></script>
    <script src="app.js" defer></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <div class="container mx-auto px-4 py-8 flex-grow">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Speaker Design Tool v1.15</h1>
            <p class="text-gray-600">Professional Audio System Calculator</p>
        </header>

        <nav class="flex flex-wrap space-x-2 sm:space-x-4 mt-4 mb-6" id="nav-buttons">
            <button data-view="view-calculator" class="nav-btn active">Calculator</button>
            <button data-view="view-database" class="nav-btn">Database</button>
            <button data-view="view-report" class="nav-btn">Reports</button>
            <button data-view="view-explanations" class="nav-btn">Explanations</button>
            <a href="manual.html" target="_blank" class="nav-btn ml-auto">User Manual</a>
        </nav>

        <div id="view-calculator" class="view active">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <label class="form-label font-semibold text-lg">Project Name</label>
                <input type="text" id="project-name" class="form-input" value="Untitled Project">
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex space-x-4 mb-6" id="calculator-tabs">
                    <button id="tab-low-z" data-view="calculator-view-low-z" class="db-nav-btn active">Low-Z Calculator</button>
                    <button id="tab-high-v" data-view="calculator-view-high-v" class="db-nav-btn">100V Calculator</button>
                </div>

                <div id="calculator-view-low-z" class="db-view active">
                    <h2 class="text-xl font-semibold mb-4">Low-Impedance Calculator</h2>
                    <form class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="form-label">Select Amplifier (New Line)</label><select id="low-z-amp" class="form-select">
                                <option value="">-- Select Amplifier --</option>
                            </select></div>
                        <div><label class="form-label">Or Select ID (Tap Line)</label><select id="low-z-tap-id" class="form-select">
                                <option value="">-- Select Tap --</option>
                            </select></div>
                        <div><label class="form-label">Select Speaker</label><select id="low-z-speaker" class="form-select">
                                <option value="">-- Select Speaker --</option>
                            </select></div>
                        <div><label class="form-label">Speakers in Parallel</label><input type="number" id="low-z-parallel" class="form-input" value="1" min="1"></div>
                        <div><label class="form-label">Main Cable Run</label><select id="low-z-cable-1" class="form-select">
                                <option value="">-- Select Cable --</option>
                            </select></div>
                        <div><label class="form-label">Length (m)</label><input type="number" id="low-z-length-1" class="form-input" step="0.1" min="0"></div>
                        <div><label class="form-label">Final Cable Run (Optional)</label><select id="low-z-cable-2" class="form-select">
                                <option value="">-- Select Cable --</option>
                            </select></div>
                        <div><label class="form-label">Length (m)</label><input type="number" id="low-z-length-2" class="form-input" step="0.1" min="0"></div>
                        <div class="md:col-span-2"><label class="flex items-center"><input type="checkbox" id="low-z-bridge-mode" class="mr-2"><span>Use Bridge Mode</span></label></div>
                    </form>
                    <div class="mt-6 flex flex-wrap gap-4">
                        <button id="add-low-z-calculation" class="btn btn-primary">Add Calculation</button>
                        <button id="import-low-z" class="btn btn-secondary">Import CSV</button>
                        <button id="export-low-z" class="btn btn-secondary">Export CSV</button>
                        <button id="clear-low-z" class="btn btn-danger">Clear Results</button>
                    </div>
                    <input type="file" id="import-low-z-file" class="hidden" accept=".csv">
                    
                    <div class="mt-8">
                        <div class="results-grid-header-low-z">
                            <div class="font-semibold">ID</div>
                            <div class="font-semibold">Details</div>
                            <div class="font-semibold">Cable Run (This Leg)</div>
                            <div class="font-semibold">Load</div>
                            <div class="font-semibold">Voltage Drop</div>
                            <div class="font-semibold">Power Loss (W)</div>
                            <div class="font-semibold">SPL Loss</div>
                            <div class="font-semibold">Total DF</div>
                            <div class="font-semibold">Status</div>
                        </div>
                        <div id="low-z-results">
                            </div>
                    </div>
                </div>

                <div id="calculator-view-high-v" class="db-view">
                    <h2 class="text-xl font-semibold mb-4">100V Calculator</h2>
                    <form class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="form-label">Start New Line</label><select id="high-v-amp" class="form-select">
                                <option value="">-- Select Amplifier --</option>
                            </select></div>
                        <div><label class="form-label">Or Select ID (Tap Line)</label><select id="high-v-tap-id" class="form-select">
                                <option value="">-- Select Tap --</option>
                            </select></div>
                        <div><label class="form-label">Select Speaker</label><select id="high-v-speaker" class="form-select">
                                <option value="">-- Select Speaker --</option>
                            </select></div>
                        <div><label class="form-label">Speaker Tap (W)</label><select id="high-v-powertap" class="form-select">
                                <option value="">-- Select Speaker First --</option>
                            </select></div>
                        <div><label class="form-label">Main Cable Run</label><select id="high-v-cable-1" class="form-select">
                                <option value="">-- Select Cable --</option>
                            </select></div>
                        <div><label class="form-label">Length (m)</label><input type="number" id="high-v-length-1" class="form-input" step="0.1" min="0"></div>
                        <div><label class="form-label">Final Cable Run (Optional)</label><select id="high-v-cable-2" class="form-select">
                                <option value="">-- Select Cable --</option>
                            </select></div>
                        <div><label class="form-label">Length (m)</label><input type="number" id="high-v-length-2" class="form-input" step="0.1" min="0"></div>
                    </form>
                    <div class="mt-6 flex flex-wrap gap-4">
                        <button id="add-high-v-calculation" class="btn btn-primary">Add Calculation</button>
                        <button id="import-high-v" class="btn btn-secondary">Import CSV</button>
                        <button id="export-high-v" class="btn btn-secondary">Export CSV</button>
                        <button id="clear-high-v" class="btn btn-danger">Clear Results</button>
                    </div>
                    <input type="file" id="import-high-v-file" class="hidden" accept=".csv">
                    
                    <div class="mt-8">
                        <div class="results-grid-header-high-v">
                            <div class="font-semibold">ID</div>
                            <div class="font-semibold">Details</div>
                            <div class="font-semibold">Cable Run (This Leg)</div>
                            <div class="font-semibold">Total Power (This Line)</div>
                            <div class="font-semibold">Voltage at Tap</div>
                            <div class="font-semibold">Power Loss (W)</div>
                            <div class="font-semibold">Status</div>
                        </div>
                         <div id="high-v-results">
                            </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="view-database" class="view">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6">Equipment Database</h2>
                
                <div class="flex space-x-2 mb-6 border-b border-gray-200" id="database-tabs">
                    <button id="tab-db-speakers" data-view="db-view-speakers" class="db-nav-btn active">Manage Speakers</button>
                    <button id="tab-db-cables" data-view="db-view-cables" class="db-nav-btn">Manage Cables</button>
                    <button id="tab-db-amplifiers" data-view="db-view-amplifiers" class="db-nav-btn">Manage Amplifiers</button>
                </div>

                <div id="db-view-speakers" class="db-view active">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1">
                            <h3 class="text-lg font-semibold mb-4">Add / Edit Speaker</h3>
                            <form id="form-add-speaker" class="space-y-4">
                                <input type="hidden" id="db-speaker-original-key">
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="form-label">* Model (Unique ID)</label><input id="db-speaker-model" type="text" class="form-input" required></div>
                                    <div><label class="form-label">Brand</label><input id="db-speaker-brand" type="text" class="form-input"></div>
                                    <div><label class="form-label">* Impedance (Ω)</label><input id="db-speaker-impedance" type="number" class="form-input" required></div>
                                    <div><label class="form-label">* Wattage (RMS)</label><input id="db-speaker-wattage_rms" type="number" class="form-input" required></div>
                                    <div><label class="form-label">Wattage (Peak)</label><input id="db-speaker-wattage_peak" type="number" class="form-input"></div>
                                    <div><label class="form-label">Max SPL (dB)</label><input id="db-speaker-max_spl" type="number" class="form-input"></div>
                                </div>
                                <div><label class="form-label">100V Taps (e.g., 60,30,15)</label><input id="db-speaker-taps" type="text" class="form-input"></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label">Type</label>
                                        <select id="db-speaker-type" class="form-select">
                                            <option value="Both">Both</option>
                                            <option value="Low-Z">Low-Z Only</option>
                                            <option value="100V">100V Only</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">* Category</label>
                                        <select id="db-speaker-category" class="form-select" required>
                                            <option value="satellite">Satellite</option>
                                            <option value="small_fullrange">Small Fullrange</option>
                                            <option value="large_fullrange">Large Fullrange</option>
                                            <option value="subwoofer">Subwoofer</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" id="btn-add-speaker" class="btn btn-primary w-full">Add Speaker</button>
                                <button type="button" id="btn-cancel-edit-speaker" class="btn btn-secondary w-full hidden">Cancel Edit</button>
                            </form>
                            <h3 class="text-lg font-semibold mb-4 mt-8">Manage Database</h3>
                             <div class="flex flex-wrap gap-2">
                                <button id="db-export-speakers" class="btn btn-secondary btn-sm">Export CSV</button>
                                <button id="db-import-speakers" class="btn btn-secondary btn-sm">Import CSV</button>
                                <button id="db-clear-speakers" class="btn btn-danger btn-sm">Clear All</button>
                            </div>
                            <input type="file" id="import-speaker-file" class="hidden" accept=".csv">
                        </div>
                        <div class="lg:col-span-2">
                            <h3 class="text-lg font-semibold mb-4">Current Speakers</h3>
                            <div class="overflow-auto max-h-96">
                                <table class="min-w-full">
                                    <thead class="sticky top-0 bg-gray-100">
                                        <tr>
                                            <th>Model</th><th>Brand</th><th>Imp.</th><th>W (RMS)</th><th>W (Peak)</th>
                                            <th>SPL</th><th>Taps</th><th>Type</th><th>Category</th><th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="speakers-database-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="db-view-cables" class="db-view">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1">
                            <h3 class="text-lg font-semibold mb-4">Add / Edit Cable</h3>
                            <form id="form-add-cable" class="space-y-4">
                                <input type="hidden" id="db-cable-original-key">
                                <div><label class="form-label">* Name / Gauge (Unique ID)</label><input id="db-cable-name" type="text" class="form-input" placeholder="e.g., 2.5mm²" required></div>
                                <div><label class="form-label">Brand</label><input id="db-cable-brand" type="text" class="form-input" placeholder="e.g., Generic"></div>
                                <div><label class="form-label">Model</label><input id="db-cable-model" type="text" class="form-input" placeholder="e.g., Standard OFC"></div>
                                <div><label class="form-label">* Resistance (Ω/km)</label><input id="db-cable-resistance" type="number" step="0.01" class="form-input" placeholder="e.g., 7.41" required></div>
                                <button type="submit" id="btn-add-cable" class="btn btn-primary w-full">Add Cable</button>
                                <button type="button" id="btn-cancel-edit-cable" class="btn btn-secondary w-full hidden">Cancel Edit</button>
                            </form>
                            <h3 class="text-lg font-semibold mb-4 mt-8">Manage Database</h3>
                             <div class="flex flex-wrap gap-2">
                                <button id="db-export-cables" class="btn btn-secondary btn-sm">Export CSV</button>
                                <button id="db-import-cables" class="btn btn-secondary btn-sm">Import CSV</button>
                                <button id="db-clear-cables" class="btn btn-danger btn-sm">Clear All</button>
                            </div>
                             <input type="file" id="import-cable-file" class="hidden" accept=".csv">
                        </div>
                        <div class="lg:col-span-2">
                            <h3 class="text-lg font-semibold mb-4">Current Cables</h3>
                            <div class="overflow-auto max-h-96">
                                <table class="min-w-full">
                                    <thead class="sticky top-0 bg-gray-100"><tr><th>Name</th><th>Brand</th><th>Model</th><th>Resistance (Ω/km)</th><th>Actions</th></tr></thead>
                                    <tbody id="cables-database-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="db-view-amplifiers" class="db-view">
                     <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1">
                            <h3 class="text-lg font-semibold mb-4">Add / Edit Amplifier</h3>
                            <form id="form-add-amplifier" class="space-y-4">
                                <input type="hidden" id="db-amp-original-key">
                                <div><label class="form-label">* Model (Unique ID)</label><input id="db-amp-model" type="text" class="form-input" required></div>
                                <div><label class="form-label">Brand</label><input id="db-amp-brand" type="text" class="form-input"></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="form-label">* Damping Factor</label><input id="db-amp-df" type="number" class="form-input" required></div>
                                    <div><label class="form-label">* DF Rated At (Ω)</label><input id="db-amp-df_rated_at" type="number" class="form-input" required></div>
                                    <div><label class="form-label">* Min Load (Ω)</label><input id="db-amp-min_load" type="number" step="0.1" class="form-input" required></div>
                                    <div><label class="form-label">* Watt (8Ω)</label><input id="db-amp-watt_8" type="number" class="form-input" required></div>
                                    <div><label class="form-label">Watt (4Ω)</label><input id="db-amp-watt_4" type="number" class="form-input"></div>
                                    <div><label class="form-label">Watt (2Ω)</label><input id="db-amp-watt_2" type="number" class="form-input"></div>
                                    <div><label class="form-label">W (1ch, 100V)</label><input id="db-amp-watt_100v" type="number" class="form-input"></div>
                                    <div><label class="form-label">Min Load (Bridge)</label><input id="db-amp-min_load_bridge" type="number" step="0.1" class="form-input"></div>
                                    <div><label class="form-label">W (Bridge 8Ω)</label><input id="db-amp-watt_bridge_8" type="number" class="form-input"></div>
                                    <div><label class="form-label">W (Bridge 4Ω)</label><input id="db-amp-watt_bridge_4" type="number" class="form-input"></div>
                                </div>
                                <button type="submit" id="btn-add-amplifier" class="btn btn-primary w-full">Add Amplifier</button>
                                <button type="button" id="btn-cancel-edit-amplifier" class="btn btn-secondary w-full hidden">Cancel Edit</button>
                            </form>
                            <h3 class="text-lg font-semibold mb-4 mt-8">Manage Database</h3>
                             <div class="flex flex-wrap gap-2">
                                <button id="db-export-amps" class="btn btn-secondary btn-sm">Export CSV</button>
                                <button id="db-import-amps" class="btn btn-secondary btn-sm">Import CSV</button>
                                <button id="db-clear-amps" class="btn btn-danger btn-sm">Clear All</button>
                            </div>
                             <input type="file" id="import-amp-file" class="hidden" accept=".csv">
                        </div>
                        <div class="lg:col-span-2">
                            <h3 class="text-lg font-semibold mb-4">Current Amplifiers</h3>
                            <div class="overflow-auto max-h-96">
                                <table class="min-w-full">
                                    <thead class="sticky top-0 bg-gray-100">
                                        <tr>
                                            <th>Model</th><th>Brand</th><th>DF</th><th>DF @</th><th>Min Load</th>
                                            <th>W (8Ω)</th><th>W (4Ω)</th><th>W (2Ω)</th><th>W (100V)</th>
                                            <th>Min (Bridge)</th><th>W (B-8Ω)</th><th>W (B-4Ω)</th><th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="amplifiers-database-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div id="view-report" class="view">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6">System Report</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 border rounded-lg">
                    <div><label class="form-label">Company Name</label><input type="text" id="report-company-name" class="form-input" placeholder="Your Company Name"></div>
                    <div><label class="form-label">Project Name</label><input type="text" id="report-project-name" class="form-input" placeholder="e.g., Main Hall Install"></div>
                    <div><label class="form-label">System Designer</label><input type="text" id="report-designer-name" class="form-input" placeholder="e.g., Jane Doe"></div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex space-x-4">
                        <button id="generate-pdf" class="btn btn-primary">Generate PDF Report</button>
                        <button id="export-combined-csv" class="btn btn-secondary">Export All as CSV</button>
                    </div>
                    
                    <div id="report-content"></div>
                    
                    <div class="mt-8 border-t pt-8">
                        <h3 class="text-xl font-semibold mb-4">Detailed Calculation Tables</h3>
                        
                        <div class="mb-8">
                            <h4 class="text-lg font-medium mb-2 text-gray-700">Low-Impedance Calculations</h4>
                            <div id="low-z-calculations-list"></div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-medium mb-2 text-gray-700">100V Calculations</h4>
                            <div id="high-v-calculations-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="view-explanations" class="view">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6">Technical Explanations & Theory</h2>
                
                <div class="space-y-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4">Theory & Standards</h3>
                    
                    <div class="elaboration-box">
                        <h5>Low-Z: Voltage Drop Standards</h5>
                        <p>Voltage Drop is the percentage of power lost as heat in the cable. This loss is inaudible up to a point, but excessive loss can lower volume and overheat cables. The standards used in this tool are based on speaker category:</p>
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li><strong>Subwoofers & Large Fullrange:</strong> Require high power.
                                <br><strong>Warning: > 2.5%</strong> | <strong>Hazard: > 5%</strong></li>
                            <li><strong>Satellites & Small Fullrange:</strong> Less critical.
                                <br><strong>Warning: > 5%</strong> | <strong>Hazard: > 10%</strong></li>
                        </ul>
                    </div>
                    
                     <div class="elaboration-box">
                        <h5>Low-Z: Damping Factor (DF)</h5>
                        <p>Damping Factor is a measure of the amplifier's ability to control the movement of the speaker cone. It is the ratio of the speaker's impedance to the *total* resistance in the line (Amp Output + Cable Resistance).</p>
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li><strong>High DF (> 20):</strong> Good. The amp has tight control, resulting in a "tight" and accurate bass response.</li>
                            <li><strong>Low DF (< 20):</strong> Warning. The amp has less control, which can result in a "muddy" or "boomy" bass sound.</li>
                            <li><strong>Very Low DF (< 10):</strong> Hazard. The sound quality will be significantly degraded.</li>
                        </ul>
                        <p class="mt-2">High voltage drop is caused by high cable resistance, and <strong>high cable resistance mathematically guarantees a low Damping Factor</strong>. This is the main reason why warnings for subs are so strict.</p>
                    </div>

                    <div class="elaboration-box">
                        <h5 class="text-lg">The Real-World Impact of Voltage Drop</h5>
                        <p>Voltage drop isn't just a number; it's a direct measure of how much power you are wasting as heat in the cable instead of as sound from the speaker. This "power loss" has four main negative effects:</p>
                        
                        <h6 class="font-semibold mt-3 mb-1">1. It's a POWER Problem, not a Voltage Problem</h6>
                        <p>This is the most critical concept. Power $P = V^2/Z$. Because power is proportional to the *square* of the voltage, a small voltage drop causes a much larger power loss.</p>
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li>A <strong>10% Voltage Drop</strong> means <strong>19% of your amp's power is lost</strong> (0.90 * 0.90 = 0.81).</li>
                            <li>A <strong>15% Voltage Drop</strong> means <strong>28% of your amp's power is lost</strong> (0.85 * 0.85 = 0.72).</li>
                        </ul>

                        <h6 class="font-semibold mt-3 mb-1">2. Loss of Dynamics (Crest Factor)</h6>
                        <p>Music is not a constant tone; it's dynamic, with quiet parts and loud, sharp peaks (like a snare hit or cymbal crash). This is the "crest factor." These peaks demand huge, short-term bursts of *current* from the amplifier. High cable resistance (which causes voltage drop) *chokes* this current. The voltage "sags" during the peak, and the peak gets "squashed." This is <strong>dynamic compression</strong>. The system sounds flat, dull, and lifeless because the sharp, exciting parts of the music are being filtered out by the wire.</p>

                        <h6 class="font-semibold mt-3 mb-1">3. Amplifier Strain & Premature Limiting</h6>
                        <p>Your amplifier has to work harder to overcome the cable resistance, wasting a large portion of its power as heat in the cable. Furthermore, an amplifier's built-in <strong>limiters</strong> are designed to protect it from dangerous conditions. High cable resistance can cause the amp to hit its protection limits (either voltage or current limiting) *prematurely*. The amp will "clip" or "limit" the signal long before the speaker reaches its full potential. You've paid for a 500W amplifier but the cable is forcing it to act like a 300W amplifier.</p>

                        <h6 class="font-semibold mt-3 mb-1">4. Voltage Drop Profile (What You Hear)</h6>
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li><strong>2.5% VD (-0.22 dB):</strong> The professional limit for subwoofers. This loss is inaudible, but ensures the Damping Factor remains high and the bass stays "tight."</li>
                            <li><strong>5.0% VD (-0.45 dB):</strong> The warning limit for satellites. This is the point where the SPL loss is just becoming perceptible to the human ear. Dynamics are slightly reduced.</li>
                            <li><strong>7.5% VD (-0.68 dB):</strong> Clearly audible volume loss. Bass response is noticeably "looser" or "muddier" due to the compromised Damping Factor.</li>
                            <li><strong>10.0% VD (-0.91 dB):</strong> <span class="badge badge-yellow">Hazard Level</span>. Nearly 20% of your amp power is gone. Dynamic peaks are audibly "squashed." The system sounds strained.</li>
                            <li><strong>15.0% VD (-1.41 dB):</strong> <span class="badge badge-red">Critical Failure</span>. Nearly 30% of your power is lost. The sound is heavily compressed, the amp is at risk of overheating, and the bass is likely "boomy" and uncontrolled.</li>
                        </ul>
                    </div>
        
                     <div class="elaboration-box">
                        <h5>High-V (100V): Voltage & Power Standards</h5>
                        <p>100V systems work by using a high voltage to send audio over long distances, which is "stepped down" by a transformer at each speaker. The main concern is ensuring the voltage at the speaker's transformer is high enough to work properly.</p>
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li><strong>Warning (< 95V):</strong> The voltage is dropping. This causes a minor, often inaudible, loss of volume.</li>
                            <li><strong>Hazard (< 90V):</strong> The voltage is too low. The speaker's transformer may "saturate," which can cause distortion, overheating, and damage to both the speaker and the amplifier.</li>
                            <li><strong>Amplifier Headroom:</strong> It is standard practice to leave 10-20% headroom on the amplifier. This tool will show a <strong>Warning</strong> if your total power is > 90% of the amp's 100V rating and a <strong>Hazard</strong> if it is > 100%.</li>
                        </ul>
                    </div>
                </div>
                
                <hr class="my-8">
        
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Low-Impedance (Low-Z) Calculations</h3>
                        <div class="space-y-4">
                            <div class="formula-box">
                                <span class="var">Leg Resistance (R_leg)</span>
                                <pre>R_leg = (Cable_Ω_per_km * Length_m * 2) / 1000</pre>
                                <span class="desc">Calculates the total resistance for a round trip of a single cable segment.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Branch Impedance (Z_branch)</span>
                                <pre>Z_branch = Z_speaker + R_leg</pre>
                                <span class="desc">The total load of a single branch is its speaker's impedance plus its own cable's resistance.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Total Load (Z_total)</span>
                                <pre>Z_total = 1 / ( (1 / Z_branch_1) + (1 / Z_branch_2) + ... )</pre>
                                <span class="desc">The total load seen by the amplifier is the parallel combination of all branches.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Source Voltage & Current</span>
                                <pre>V_source = √(P_amplifier * Z_total)</pre>
                                <pre>I_total = V_source / Z_total</pre>
                                <span class="desc">Calculates the true voltage and current leaving the amplifier based on its power rating at the total load.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Branch Voltage & Current</span>
                                <pre>V_at_node = V_parent - (I_parent * R_parent_leg)</pre>
                                <pre>I_branch = V_at_node / Z_branch</pre>
                                <span class="desc">The voltage at any node is the voltage from its parent, minus the drop in the parent's cable. This new voltage determines the current in the branch.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Voltage Drop (%)</span>
                                <pre>V_at_speaker = V_at_node - (I_branch * R_leg)</pre>
                                <pre>V_drop_% = (V_source - V_at_speaker) / V_source * 100</pre>
                                <span class="desc">The *total* voltage lost from the amplifier all the way to the speaker.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Amplifier Output Impedance (Z_amp)</span>
                                <pre>Z_amp = DF_Rated_At_Ω / Damping_Factor</pre>
                                <span class="desc">The internal resistance of the amplifier, calculated from its specs.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Total Damping Factor (DF_total)</span>
                                <pre>DF_total = Z_speaker / (R_total_cable_run + Z_amp)</pre>
                                <span class="desc">The true damping factor at the speaker terminals. (R_total_cable_run is the sum of all cable legs from the amp to the speaker).</span>
                            </div>
                             <div class="formula-box">
                                <span class="var">SPL Loss (dB)</span>
                                <pre>P_at_speaker = V_at_speaker² / Z_speaker</pre>
                                <pre>SPL_Loss = 10 * log10(P_at_speaker / P_speaker_RMS)</pre>
                                <span class="desc">The audible volume loss in decibels, comparing the actual power at the speaker vs. its rated RMS power.</span>
                            </div>
                        </div>
                    </div>
        
                    <div>
                        <h3 class="text-xl font-semibold mb-4">High-Impedance (100V) Calculations</h3>
                        <div class="space-y-4">
                            <div class="formula-box">
                                <span class="var">Total Power (P_total)</span>
                                <pre>P_total = P_node + P_child_1 + P_child_2 + ...</pre>
                                <span class="desc">The total power on the line is the sum of all speaker tap settings.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Line Current (I)</span>
                                <pre>I = P_total / V_start (e.g., 100V)</pre>
                                <span class="desc">Calculates the total current drawn by all speakers on this segment.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Voltage Drop (V_drop)</span>
                                <pre>V_drop = LineCurrent * Cable_Resistance</pre>
                                <span class="desc">The amount of voltage lost as heat in this specific cable segment.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Voltage at Node (V_node)</span>
                                <pre>V_node = V_start - V_drop</pre>
                                <span class="desc">The new, lower voltage available at the end of this cable segment.</span>
                            </div>
                            <div class="formula-box">
                                <span class="var">Power at Speaker (P_speaker)</span>
                                <pre>P_speaker = PowerTap * (V_node / V_start)²</pre>
                                <span class="desc">The *actual* power delivered to the speaker. Power scales with the *square* of the voltage.</span>
                            </div>
                        </div>
                    </div>
        
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Status Messages</h3>
                        <div class="space-y-2">
                            <p><span class="badge badge-green">OK</span> - All calculations are within nominal parameters.</p>
                            <p><span class="badge badge-yellow">Warning</span> - The system is approaching a limit.
                                <br> &bull; **Low-Z:** Amp > 90% | Low DF (< 20)
                                <br> &bull; **Low-Z (Satellites/Small):** High VD (> 5%)
                                <br> &bull; **Low-Z (Subwoofers/Large):** High VD (> 2.5%)
                                <br> &bull; **High-V:** Amp > 90% | < 95V at Tap
                            </p>
                            <p><span class="badge badge-red">Hazard</span> - The system is outside of safe parameters.
                                <br> &bull; **Low-Z:** Amp Overload | Amp Min Load | Low DF (< 10)
                                <br> &bull; **Low-Z (Satellites/Small):** High VD (> 10%)
                                <br> &bull; **Low-Z (Subwoofers/Large):** High VD (> 5%)
                                <br> &bull; **High-V:** Amp Overload | < 90V at Tap
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div id="confirmation-modal" class="modal">
            <div class="modal-content">
                <h3 class="text-lg font-semibold mb-4">Confirm Action</h3>
                <p id="confirmation-message" class="mb-6"></p>
                <div class="flex justify-end space-x-4">
                    <button id="confirm-cancel" class="btn btn-secondary">Cancel</button>
                    <button id="confirm-ok" class="btn btn-danger">Confirm</button>
                </div>
            </div>
        </div>

        <div id="message-modal" class="modal">
            <div class="modal-content">
                <h3 id="message-title" class="text-lg font-semibold mb-4"></h3>
                <p id="message-text" class="mb-6"></p>
                <div class="flex justify-end">
                    <button id="message-ok" class="btn btn-primary">OK</button>
                </div>
            </div>
        </div>

    </div>
    
    <footer class="app-footer">
        App Admin: Sindre Løvlie Haugen | E-mail: <a href="mailto:sindre.haugen@gmail.com">sindre.haugen@gmail.com</a> | LinkedIn: <a href="https://www.linkedin.com/in/sindrelhaugen/" target="_blank">linkedin.com/in/sindrelhaugen</a>
    </footer>
    
</body>
</html>